<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Real Estate Investment Tool</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ2FuYWRpYW4gUmVhbCBFc3RhdGUgVG9vbCIsInNob3J0X25hbWUiOiJSRSBUb29sIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTMzMmUiLCJ0aGVtZV9jb2xvciI6IiMxMGI5ODEiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lpSUhacFpYZENiM2c5SWpBZ01DQXhNamdnTVRJNENPZ1BjSEJoZEdnZ1ptbHNiRDBpSXpFd1lqa3dNVkl4UXpaRFFVWmFOQ2NnWkQwaWJURTJMamczTnlBeE1qbDBlUzFoTXpBdUx6UmhNekEyUGctczFSb01XNnpGSWdBQUFBQkpSVTVFcmtKZ2dnPT0iLCJzaXplcyI6IjEyOHgxMjgiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <meta name="theme-color" content="#10b981">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e332e 0%, #2d5a4a 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(16, 185, 129, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .header h1 {
            color: #10b981;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 15px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            background: rgba(16, 185, 129, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: #10b981;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(16, 185, 129, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #10b981;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: rgba(107, 114, 128, 0.8);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .results {
            background: rgba(16, 185, 129, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(16, 185, 129, 0.3);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-value {
            font-weight: bold;
            color: #10b981;
        }

        .property-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .property-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .property-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.2);
        }

        .property-card h3 {
            color: #10b981;
            margin-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
        }

        .google-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .google-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Canadian Real Estate Investment Tool</h1>
            <p>Your comprehensive toolkit for mortgage calculations and property underwriting</p>
        </div>

        <div id="loginPage" class="page active">
            <div class="login-container">
                <div class="card" style="max-width: 400px; margin: 0 auto;">
                    <h2 style="color: #10b981; margin-bottom: 20px;">Welcome Back</h2>
                    <p style="margin-bottom: 30px; opacity: 0.8;">Sign in with Google to save your work and access it anywhere</p>
                    <button class="google-btn" onclick="signInWithGoogle()">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Sign in with Google
                    </button>
                    <button class="btn-secondary" onclick="continueAsGuest()" style="margin-top: 15px; width: 100%;">
                        Continue as Guest
                    </button>
                </div>
            </div>
        </div>

        <div id="mainApp" class="page">
            <div class="user-info">
                <div id="userProfile">
                    <span id="userName">Guest User</span>
                </div>
                <div>
                    <button onclick="saveAllData()" class="btn-secondary">üíæ Save All</button>
                    <button onclick="signOut()" class="btn-secondary">Sign Out</button>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showPage('dashboard')">üìä Dashboard</button>
                <button class="nav-tab" onclick="showPage('mortgage')">üè¶ Mortgage Calculator</button>
                <button class="nav-tab" onclick="showPage('underwriting')">üìã Underwriting</button>
                <button class="nav-tab" onclick="showPage('cashflow')">üí∞ Cash Flow Analysis</button>
                <button class="nav-tab" onclick="showPage('comparison')">‚öñÔ∏è Property Comparison</button>
                <button class="nav-tab" onclick="showPage('portfolio')">üìà Portfolio Overview</button>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="card">
                    <h2>üìä Investment Dashboard</h2>
                    <div class="form-row">
                        <div class="card">
                            <h3>Quick Stats</h3>
                            <div id="quickStats">
                                <div class="result-item">
                                    <span>Saved Properties:</span>
                                    <span class="result-value" id="totalProperties">0</span>
                                </div>
                                <div class="result-item">
                                    <span>Total Investment:</span>
                                    <span class="result-value" id="totalInvestment">$0</span>
                                </div>
                                <div class="result-item">
                                    <span>Monthly Cash Flow:</span>
                                    <span class="result-value" id="totalCashFlow">$0</span>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <h3>Recent Activity</h3>
                            <div id="recentActivity">
                                <p style="opacity: 0.7;">No recent activity</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mortgage Calculator Page -->
            <div id="mortgage" class="page">
                <div class="card">
                    <h2>üè¶ Advanced Mortgage Calculator</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="purchasePrice">Purchase Price ($)</label>
                            <input type="number" id="purchasePrice" placeholder="500000">
                        </div>
                        <div class="form-group">
                            <label for="downPayment">Down Payment (%)</label>
                            <input type="number" id="downPayment" placeholder="20" min="5" max="100">
                        </div>
                        <div class="form-group">
                            <label for="interestRate">Interest Rate (%)</label>
                            <input type="number" id="interestRate" step="0.01" placeholder="5.25">
                        </div>
                        <div class="form-group">
                            <label for="amortization">Amortization (years)</label>
                            <select id="amortization">
                                <option value="25">25 years</option>
                                <option value="30">30 years</option>
                                <option value="35">35 years</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentFreq">Payment Frequency</label>
                            <select id="paymentFreq">
                                <option value="monthly">Monthly</option>
                                <option value="bi-weekly">Bi-weekly</option>
                                <option value="weekly">Weekly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="propertyTax">Annual Property Tax ($)</label>
                            <input type="number" id="propertyTax" placeholder="8000">
                        </div>
                        <div class="form-group">
                            <label for="insurance">Annual Insurance ($)</label>
                            <input type="number" id="insurance" placeholder="2000">
                        </div>
                        <div class="form-group">
                            <label for="cmhcPremium">CMHC Premium (%)</label>
                            <input type="number" id="cmhcPremium" step="0.01" placeholder="2.8" readonly>
                        </div>
                    </div>
                    <button onclick="calculateMortgage()">Calculate Mortgage</button>
                    
                    <div id="mortgageResults" class="results" style="display: none;">
                        <h3>Mortgage Results</h3>
                        <div id="mortgageResultsContent"></div>
                        <div class="chart-container">
                            <canvas id="mortgageChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Underwriting Page -->
            <div id="underwriting" class="page">
                <div class="card">
                    <h2>üìã Property Underwriting Tool</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="propertyAddress">Property Address</label>
                            <input type="text" id="propertyAddress" placeholder="123 Main St, Toronto, ON">
                        </div>
                        <div class="form-group">
                            <label for="propertyType">Property Type</label>
                            <select id="propertyType">
                                <option value="single-family">Single Family</option>
                                <option value="duplex">Duplex</option>
                                <option value="triplex">Triplex</option>
                                <option value="fourplex">Fourplex</option>
                                <option value="condo">Condominium</option>
                                <option value="townhouse">Townhouse</option>
                            </select>
                        </div>
                    </div>

                    <h3>Income Analysis</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="monthlyRent">Monthly Rental Income ($)</label>
                            <input type="number" id="monthlyRent" placeholder="3500">
                        </div>
                        <div class="form-group">
                            <label for="vacancy">Vacancy Rate (%)</label>
                            <input type="number" id="vacancy" placeholder="5" min="0" max="50">
                        </div>
                        <div class="form-group">
                            <label for="otherIncome">Other Monthly Income ($)</label>
                            <input type="number" id="otherIncome" placeholder="0">
                        </div>
                    </div>

                    <h3>Operating Expenses</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="maintenance">Annual Maintenance ($)</label>
                            <input type="number" id="maintenance" placeholder="5000">
                        </div>
                        <div class="form-group">
                            <label for="management">Property Management (%)</label>
                            <input type="number" id="management" placeholder="10">
                        </div>
                        <div class="form-group">
                            <label for="utilities">Monthly Utilities ($)</label>
                            <input type="number" id="utilities" placeholder="200">
                        </div>
                        <div class="form-group">
                            <label for="capEx">Annual CapEx Reserve ($)</label>
                            <input type="number" id="capEx" placeholder="3000">
                        </div>
                    </div>

                    <button onclick="performUnderwriting()">Perform Analysis</button>
                    <button onclick="saveProperty()" class="btn-secondary">Save Property</button>

                    <div id="underwritingResults" class="results" style="display: none;">
                        <h3>Underwriting Results</h3>
                        <div id="underwritingContent"></div>
                    </div>
                </div>
            </div>

            <!-- Cash Flow Analysis Page -->
            <div id="cashflow" class="page">
                <div class="card">
                    <h2>üí∞ Detailed Cash Flow Analysis</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cfPropertySelect">Select Property</label>
                            <select id="cfPropertySelect">
                                <option value="">Choose a saved property...</option>
                            </select>
                        </div>
                    </div>
                    
                    <h3>Additional Cash Flow Factors</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appreciationRate">Annual Appreciation Rate (%)</label>
                            <input type="number" id="appreciationRate" step="0.1" placeholder="3.5">
                        </div>
                        <div class="form-group">
                            <label for="rentIncrease">Annual Rent Increase (%)</label>
                            <input type="number" id="rentIncrease" step="0.1" placeholder="2.5">
                        </div>
                        <div class="form-group">
                            <label for="analysisYears">Analysis Period (years)</label>
                            <input type="number" id="analysisYears" placeholder="10" min="1" max="30">
                        </div>
                    </div>

                    <button onclick="generateCashFlowAnalysis()">Generate Analysis</button>

                    <div id="cashflowResults" class="results" style="display: none;">
                        <div class="chart-container">
                            <canvas id="cashflowChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Property Comparison Page -->
            <div id="comparison" class="page">
                <div class="card">
                    <h2>‚öñÔ∏è Property Comparison Tool</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="compareProperty1">Property 1</label>
                            <select id="compareProperty1">
                                <option value="">Select property...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="compareProperty2">Property 2</label>
                            <select id="compareProperty2">
                                <option value="">Select property...</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="compareProperties()">Compare Properties</button>

                    <div id="comparisonResults" class="results" style="display: none;">
                        <div id="comparisonContent"></div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Overview Page -->
            <div id="portfolio" class="page">
                <div class="card">
                    <h2>üìà Portfolio Overview</h2>
                    <div class="property-list" id="portfolioList">
                        <p style="opacity: 0.7;">No properties in portfolio yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let properties = [];
        let mortgageChart = null;
        let cashflowChart = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            updateDashboard();
        });

        // Authentication functions
        function signInWithGoogle() {
            // Simulate Google OAuth
            currentUser = {
                name: "John Investor",
                email: "john@example.com",
                picture: "https://via.placeholder.com/40"
            };
            
            document.getElementById('userName').textContent = currentUser.name;
            showMainApp();
            loadSavedData();
        }

        function continueAsGuest() {
            currentUser = { name: "Guest User", email: null };
            document.getElementById('userName').textContent = "Guest User";
            showMainApp();
        }

        function signOut() {
            currentUser = null;
            document.getElementById('loginPage').className = 'page active';
            document.getElementById('mainApp').className = 'page';
        }

        function showMainApp() {
            document.getElementById('loginPage').className = 'page';
            document.getElementById('mainApp').className = 'page active';
        }

        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                if (page.id !== 'loginPage' && page.id !== 'mainApp') {
                    page.classList.remove('active');
                }
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update dropdowns when showing certain pages
            if (pageId === 'cashflow' || pageId === 'comparison') {
                updatePropertyDropdowns();
            }
        }

        // Mortgage calculation functions
        function calculateMortgage() {
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const downPaymentPercent = parseFloat(document.getElementById('downPayment').value) || 20;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 5.25;
            const amortization = parseInt(document.getElementById('amortization').value) || 25;
            const paymentFreq = document.getElementById('paymentFreq').value;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            
            const downPaymentAmount = purchasePrice * (downPaymentPercent / 100);
            const loanAmount = purchasePrice - downPaymentAmount;
            
            // Calculate CMHC premium if down payment < 20%
            let cmhcPremium = 0;
            if (downPaymentPercent < 20) {
                if (downPaymentPercent >= 15) cmhcPremium = 2.8;
                else if (downPaymentPercent >= 10) cmhcPremium = 3.1;
                else cmhcPremium = 4.0;
            }
            document.getElementById('cmhcPremium').value = cmhcPremium;
            
            const cmhcAmount = loanAmount * (cmhcPremium / 100);
            const totalLoan = loanAmount + cmhcAmount;
            
            // Calculate payment based on frequency
            let paymentsPerYear, totalPayments;
            switch (paymentFreq) {
                case 'weekly': paymentsPerYear = 52; break;
                case 'bi-weekly': paymentsPerYear = 26; break;
                default: paymentsPerYear = 12; break;
            }
            
            totalPayments = amortization * paymentsPerYear;
            const monthlyRate = interestRate / 100 / 12;
            const adjustedRate = monthlyRate * (12 / paymentsPerYear);
            
            const payment = totalLoan * (adjustedRate * Math.pow(1 + adjustedRate, totalPayments)) / 
                           (Math.pow(1 + adjustedRate, totalPayments) - 1);
            
            const monthlyPayment = payment * (paymentsPerYear / 12);
            const monthlyTax = propertyTax / 12;
            const monthlyInsurance = insurance / 12;
            const totalMonthlyPayment = monthlyPayment + monthlyTax + monthlyInsurance;
            
            // Display results
            const resultsHtml = `
                <div class="result-item">
                    <span>Loan Amount:</span>
                    <span class="result-value">$${loanAmount.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>CMHC Premium:</span>
                    <span class="result-value">$${cmhcAmount.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Total Mortgage:</span>
                    <span class="result-value">$${totalLoan.toLocaleString()}</span>
                </div>
                <div class="result-item">
                    <span>Principal & Interest:</span>
                    <span class="result-value">$${monthlyPayment.toLocaleString()}/month</span>
                </div>
                <div class="result-item">
                    <span>Property Tax:</span>
                    <span class="result-value">$${monthlyTax.toLocaleString()}/month</span>
                </div>
                <div class="result-item">
                    <span>Insurance:</span>
                    <span class="result-value">$${monthlyInsurance.toLocaleString()}/month</span>
                </div>
                <div class="result-item">
                    <span